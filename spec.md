# BizLife — SPEC.md (V1.0)

Windows 桌面文字商业经营游戏规格说明（规则 + 流程 + 页面 + 数据结构 + 配置 + 交付）。

---

## 0. 目标与范围

### 0.1 产品目标
- 体验公司经营的核心逻辑：**指标 → 经营动作 → 财务 → 组织管理 → 风险/机会**。
- 允许玩家后期开设很多企业，通过**总经理托管 + 集团总部政策**实现“布局型决策”。
- 随机事件提供人生真实感：**可解释触发 + 玩家决策 + 立即/延迟后果 + 冷却**。
- 不追求微观仿真深度；复杂度控制在“能看懂、能决策、能复盘”。

### 0.2 平台与交付
- 平台：Windows
- UI：桌面窗口版（文字面板 + 按钮交互）
- 联网/支付：V1 不需要
- 存档：本地多档位（用于不同开局），但**同一局退休前不允许回滚到过去**

---

## 1. 核心设定（已定）

### 1.1 时间与回合
- 回合单位：**天**
- 玩家点击“进入下一天”才推进，不做真实计时

### 1.2 人生周期
- 开局年龄：**35–55岁随机**
- 游戏时长：**20年**
- 退休结算：到达结束年龄（开局年龄 + 20年）

### 1.3 开局资源
- 初始资金：**50万**
- 资产形态：**全现金**

### 1.4 愿景系统（可多选）
- 愿景维度：财富 / 事业 / 影响力 / 稳健
- 默认勾选：财富 + 事业
- 权重：允许自定义（总和=100%）
- 权重会影响：里程碑门槛偏移、奖励倾向、惩罚敏感度、提示优先级（见第6章）

### 1.5 市场与供应
- 贸易市场范围：**全国统一市场**
- 供应商数量：每类商品 **5–8家**
- 首发贸易品类：**快消品 + 大宗原料**
- 首发行业包：**连锁零售 / 连锁服务 / 互联网软件（电商平台）**

---

## 2. 胜利与结局（分位制 + 继承加成）

### 2.1 四维评分与总分
- 四维：W(财富) / C(事业) / I(影响力) / S(稳健)
- 终局总分：
  - `TotalScore = wW*W + wC*C + wI*I + wS*S`
  - 权重由玩家设置（总和=1）

### 2.2 分位段（6段）
- S：前1%
- A：1%–5%
- B：5%–20%
- C：20%–50%
- D：50%–80%
- E：后20%

分位基准：同难度、同寿命（20年）、同核心规则下的历史成绩分布。

### 2.3 结局输出
- 结局称号
- 复盘报告（关键曲线、关键决策、重大事件、企业版图）
- 下一局继承加成（轻量 Roguelike）

### 2.4 继承加成规则
- 规则：**占用天赋槽**，并带**轻微副作用**
- 可叠加：允许多局叠加，但每项有 Cap（通常3–5层）
- 超过 Cap：转换为“重铸点”（用于换其它天赋）

---

## 3. 日回合流程与操作限制（AP / 指令 / 重大决策名额）

### 3.1 每日流程（Loop）
1. 日开盘刷新：宏观/行业热度/市场价/供应商状态/事件权重
2. 玩家当日操作：指令 + 决策 + 事件处理 + 资金确认
3. 日终结算：经营/交易/事件/财务/风险/日志
4. 玩家确认进入下一天

### 3.2 三种“操作资源”
#### A) 指令（不耗AP）
- 特征：玩家下达即可成立；结果主要取决于组织执行与既定规则
- 受限：**企业每日指令额度 CmdCap**（超出进入队列顺延）
- 示例：发布招聘（批量岗位/人数算1条）、批量调岗任命、设定策略参数、设置预算上限、普通运营指令

**企业指令额度（推荐默认）**
- 企业等级 L1–L5
- `CmdCap = 3 + L`（L1=4…L5=8）

#### B) 决策（耗AP）
- 特征：存在外部不确定性/概率分支/延迟后果，需要拍板取舍
- 默认：**3 AP/天**，可升级到 **6**
- 示例：签大额采购合同、重仓贸易、重大营销战役、重大融资、关键平台规则调整等
- 贸易AP规则：同一商品当日买卖合并算 **1次AP**

#### C) 重大决策名额（不耗AP，独立资源）
- 每天：**1次**
- 仅覆盖三类（已定）：
  1) 并购/出售一家企业
  2) 上市/退市
  3) 新进入非首发行业
- 当日用完：进入次日队列或用AP加急（推荐）

### 3.3 “大额资金调拨确认额度”
- 集团资金池调拨：小额自动，大额需确认
- 每天：**1次确认额度**（不耗AP）
- 超过：进入次日队列或耗AP加急

---

## 4. 随机事件系统（人生真实性）

### 4.1 事件结构（配置化）
每个事件包含：
- 触发条件：年龄段、宏观、行业热度、资产/现金流、声望、风险、组织能力等
- 选项：2–4个
  - 立即结果：现金/资产/风险/声望/指标变化
  - 延迟结果：N天后触发后续事件或状态
  - 概率分支：受能力/组织/风控等修正（非纯随机）
- 冷却：同类事件 30–180天
- 严重度：C/B/A/S

### 4.2 事件严重度评定（混合）
- 财务冲击：`abs(Δ现金+Δ资产净值) / max(净资产, ε)`
- 评分冲击：`abs(ΔW)+abs(ΔC)+abs(ΔI)+abs(ΔS)`（归一化）
- 综合：`Impact = a*财务冲击 + b*评分冲击` → 映射到 C/B/A/S

### 4.3 S级事件节奏与处理
- 期望频率：平均 **180天一次**
- 机会/风险：各50%
- 消耗资源：占用当日“重大决策名额”，不耗AP

### 4.4 事件刷新（已定）
- 同日最多刷新 1 次
- 成本：现金或影响力点（IP）二选一
- 刷新等级：允许上下浮动一档（上浮概率较低）
- 世界状态保留：宏观/市场/预兆不变，仅替换“今天发生的事”
- 刷新不占重大决策名额

---

## 5. 影响力点（IP）

### 5.1 规则
- 不设上限
- 来源：综合经营积累（口碑、规模、媒体/行业声望、阶段成就）
- 主要用途：事件刷新（其他用途后续再扩展）

### 5.2 刷新成本（固定+比例混合）
- 现金刷新成本：`BaseCost(难度) + NetWorth * r(难度)`
- IP刷新成本：按事件等级分档（示例：C/B=1, A=2, S=3；可调参）

---

## 6. 愿景权重的影响（必须“有影响”但不破坏平衡）

权重同时影响：
1) **里程碑门槛偏移**：更看重高权重维度
2) **奖励倾向**：更偏向高权重维度的资源解锁
3) **惩罚敏感度**：高权重维度相关的负面更敏感
4) **提示优先级**：UI更突出权重相关风险/机会

示例：
- 财富权重高：资金工具更早更强，但现金流波动惩罚更敏感
- 事业权重高：人才/牌照/扩张机会更强，但超载惩罚更陡
- 稳健权重高：合规/杠杆/集中度惩罚更敏感
- 影响力权重高：舆情/口碑事件更敏感，CAC下降收益更大

---

## 7. 贸易系统（全国统一市场）

### 7.1 商品
首发两大类：
- 快消品：需求稳、周转快、可能有损耗/保质期
- 大宗原料：波动更大、适合套利、政策/供给冲击权重更高

商品字段（配置）：
- `base_price, volatility, storage_cost_rate, spoilage_rate, liquidity`
- `demand_base, supply_base`
- `substitute_group`（可选，用于需求转移）

### 7.2 市场定价（非纯随机）
- 市价每日更新由供需缺口、趋势动量与小噪声组成
- 大单滑点：与流动性相关
- 库存成本：仓储/损耗/资金占用

### 7.3 供应商（每商品5–8家）
供应商是实体，具备：
- 产能、交期、报价策略、可靠度、现金健康、风险评分
- 供应商风险事件：事故/涨价/违约/监管停产/被收购等

采购方式：
- 现货：快交付、价格波动更大
- 合同：锁价/锁量/交付期/预付款/违约条款

---

## 8. 行业系统（推荐值默认）

### 8.1 连锁零售（门店+库存+周转）
核心KPI：
- 客流、转化率、客单价、复购
- 缺货率、周转天数、损耗率
- 毛利率、费用率（租金/人力/物流抽象）
逻辑链：
- 选品/定价/促销 → 转化/客单/复购
- 预测/补货/供应稳定 → 缺货↓ 周转↑ 损耗↓
- 周转↑ → 资金占用↓ → 可扩张/可投营销 → 收入↑

扩张（推荐值）：
- 商圈等级 S/A/B/C（全国抽象，不做城市细分）
- 开店候选点位（3选1，可刷新一次）
- 标准化投入降低事故率并提升复制效率
- 加盟：V1不做（预留接口）

### 8.2 连锁服务（人=产能+口碑复购）
核心KPI：
- 可售工时、利用率、等待时长
- 服务质量/差评率、复购/转介绍
- 人力成本、流失率、培训投入
逻辑链：
- 招聘/培训/排班/流程 → 质量↑ 等待↓ 利用率↑
- 质量↑ → 复购↑ → 需求↑
- 产能不足 → 等待↑ 差评↑（反噬）
营销有效但受产能约束

### 8.3 互联网/软件（电商平台，佣金变现）
首发模式：
- 类型：电商平台（实物快消为主）
- 仓配：纯平台不碰物流（履约由商家）
- 抽佣：推荐默认 5%
- 结算：T+7
- 风控：均衡
- 治理工具箱：信用分 + 处罚 + 认证商家 + 评价 + 类目/品牌保护
- 自营店：中后期解锁

平台核心KPI：
- GMV、订单数、客单价
- 抽佣率、平台收入
- 退款率、投诉率、欺诈损失
- 商家数与质量分布（信用分）
逻辑链：
- 拉新/留存/复购 → 订单与GMV
- 商家供给质量 → 匹配率/退款投诉 → 口碑与留存
- 风控过松：短期GMV↑但损失↑口碑↓；过严：增长慢但稳健↑

---

## 9. 组织管理与托管（后期布局关键）

### 9.1 多企业并列（已定）
- 每家企业独立财务与指令额度
- 企业数量不设硬上限，用管理/人才/风险自然约束

### 9.2 总经理托管
解锁条件：企业达到中期阶段（推荐：企业等级≥3或里程碑触发）

托管行为：
- 托管企业的指令类操作由总经理自动执行（不占玩家指令额度）
- 玩家为企业设置：
  - KPI目标区间
  - 预算上限
  - 风险红线（杠杆/合规/供应集中度）
  - 授权边界（价格/促销/招聘/风控强度范围）
- 触发“叫玩家决策”的条件：
  - 超授权
  - 重大机会/重大危机
  - 战略分叉

总经理获取（已定）：
- 公开招聘 + 猎头 + 里程碑解锁
- 成本结构：低固定 + 高绩效/分红
- 稀缺机制：按行业/地位刷新，地位越高越多且更优

---

## 10. 集团总部（布局层）

### 10.1 共享资源（已定：部分共享）
- 集团资金池：可调拨
- 人才共享：可跨企业调动（有磨合期）
- 集团集采：你手动纳入品类（降低成本/提高稳定，提升集中风险）

### 10.2 集团政策（已定）
- 资金调拨：小额自动 + 大额需确认
- 大额确认：每日一次确认额度（不耗AP）
- 政策修改：次日生效
- 考核：每月（月报Top：净资产增长、利润率、自由现金流）

---

## 11. 并购与新行业进入

### 11.1 新行业进入（已定）
- 成本：只需启动资金
- 审批：无，立刻开展
- 属于重大决策：占用重大决策名额

### 11.2 并购系统（已定）
- 标的来源：随机刷新 + 主动搜索
- 尽调：简化（风险评分+价格）
- 付款：现金 + 分期
  - 分期档位：年化12%–18%，最长360天
- 并购后磨合期：风险评分越高磨合越久、事件概率越高

---

## 12. 难度档位（3档）

档位：轻松 / 标准 / 硬核  
影响参数（推荐值统一配置）：
- 市场波动（更大）
- 供应商断供/违约概率（更高）
- 融资环境（更严格/更贵）
- 负面事件损失（更大）
- 超载惩罚曲线（更陡）

---

## 13. 存档与不可回滚

### 13.1 存档
- 本地多档位（slot）
- 自动存档（用于续玩）
- 显示存档摘要：日期、年龄、净资产、总分、企业数、难度

### 13.2 不可回滚（同一局）
- UI不提供“加载旧存档回到过去”的入口
- 仅允许“继续游戏”加载最新状态（用于中断续玩）
- 防误操作：
  - 关键决策二次确认卡
  - 指令可在当日结算前撤销（不改变市场刷新与事件抽取）

---

## 14. 数据结构（核心对象）

### 14.1 GameState
- `seed`
- `day_index`
- `player`
- `companies{company_id: Company}`
- `group_hq`
- `market`
- `events`
- `logs`
- `config_version`

### 14.2 Player
- 年龄：`age_start`, `age_days`, `lifespan_days`
- 资源：`cash`, `net_worth`, `influence_points`
- 操作资源：`ap_base=3`, `ap_max<=6`, `ap_remaining_today`
- 名额：`major_slot_used_today`, `transfer_confirm_used_today`
- 愿景权重：`vision_weights{W,C,I,S}`

### 14.3 Company
- 身份：`company_id, name, industry_id, level`
- 托管：`managed_by_gm, gm_id`
- 指令：`cmd_cap_today, cmd_used_today, command_queue`
- KPI：行业字段集合
- 财务：`FinanceState`
- 风险：`RiskState`
- 资产：`inventory, fixed_assets_value`
- 政策：KPI目标、预算、红线

### 14.4 MarketState
- 宏观：`macro_state + macro_index`
- 行业热度：`industry_heat`
- 商品市场：`products{product_id: ProductMarket}`
- 供应商：`suppliers{supplier_id: Supplier}`

### 14.5 EventState
- `today_event`
- `delayed_queue`
- `cooldowns`
- `refresh_used_today`
- `days_since_last_S`

---

## 15. 配置驱动（Config Schema）

推荐：`/config/*.json`

### 15.1 game_rules.json
- 寿命/开局年龄范围
- AP与上限、重大决策名额、调拨确认额度
- 事件刷新规则（每日1次、等级浮动、保留世界状态）
- S级事件期望180天
- 难度参数表（easy/normal/hard）

### 15.2 industries/*.json
- 行业ID与名称
- KPI字段列表
- 日模型参数（简化公式参数）
- 动作目录（指令/决策）
- 该行业事件标签
- 成长/升级规则（L1-L5）

### 15.3 products.json
- 商品列表（快消/大宗）
- 基础价格与波动、仓储/损耗、流动性、供需基数

### 15.4 suppliers_templates.json
- 供应商分层模板（A/B/C/D）参数范围
- 每商品生成5–8家的规则

### 15.5 platform_defaults.json
- 抽佣5%、T+7、风控均衡
- 工具箱默认启用 1+2+3+4+6
- 自营店中后期解锁条件

### 15.6 events/*.json
- 事件库（先放最小可跑集合，后续扩充）
- 触发条件、选项、立即/延迟效果、冷却、严重度提示

### 15.7 milestones.json
- 月度里程碑模板（按愿景权重动态偏移）

### 15.8 inheritance_talents.json
- 分位段对应天赋池、叠加cap、副作用

---

## 16. UI 页面与交互（窗口版）

### 16.1 页面列表
1) 启动页：继续 / 新游戏 / 设置
2) 新游戏：难度、愿景勾选与权重、开局确认
3) 主面板（核心）
4) 企业详情（零售/服务/平台 tabs）
5) 贸易市场
6) 供应商与合同
7) 集团总部（资金池/集采/政策/月报）
8) 人才与组织（招聘/猎头/总经理/托管设置）
9) 事件中心（当日事件、刷新、日志）
10) 并购市场（刷新/搜索/标的卡/付款方案）
11) 月报
12) 退休结算（分位/复盘/继承天赋）

### 16.2 主面板布局（推荐）
- 顶栏：
  - 日期/年龄/剩余天数
  - TotalScore
  - 月报Top：净资产增长 / 利润率 / 自由现金流（30天滚动）
  - AP剩余、重大决策名额、调拨确认额度、IP
- 左侧：企业列表（托管标记、风险灯、现金灯）
- 中部：今日待办（指令队列、需要决策卡、提醒）
- 右侧：选中企业KPI面板 + 关键按钮
- 底部：进入下一天 + 今日结算预览

---

## 17. 核心流程（可验收）

### 17.1 日常
- 下达指令（不耗AP，受CmdCap）
- 做决策（耗AP）
- 处理事件（可刷新）
- 资金调拨确认（如触发）
- 进入下一天结算

### 17.2 托管
- 任命总经理 → 设置目标/预算/红线 → 企业自动运行
- 仅重大卡片召回玩家

### 17.3 贸易
- 查看价格 → 买/卖（同日合并计1AP）→ 库存/成本占用 → 结算

### 17.4 并购
- 刷新/搜索标的 → 查看风险评分与价格 → 现金/分期 → 并购完成与磨合期

### 17.5 月报与退休
- 每30天月报：排名、异常预警、建议模板
- 退休：分位段、复盘、天赋选择与叠加

---

## 18. MVP（最小可运行闭环）

必须跑通：
- 天推进（手动）
- 贸易买卖（价格更新、库存成本、简单滑点）
- 3类企业可创建与日结算（零售/服务/电商平台）
- 随机事件系统（至少20个事件，含延迟效果与冷却，含刷新）
- 总经理托管（至少可托管一企业并自动执行指令）
- 集团资金池与自动/确认调拨、集采清单（可勾选品类）
- 并购（标的卡+风险评分+现金/分期）
- 月报与退休结算（分位段、复盘、继承天赋）

---

## 19. 交付标准（工程与打包）

### 19.1 工程输出
- 完整源码（模块化、配置驱动）
- 默认配置文件（推荐值）
- 本地存档目录结构与兼容版本号

### 19.2 Windows可运行包
- 生成 `.exe`（推荐 PyInstaller）
- 一键打包脚本
- 运行不依赖外部安装（或最小依赖随包）

---

## 20. 非目标（V1不做）
- 联网/支付/内购
- 过细城市地理与真实物流仿真
- 加盟体系（预留接口，后续扩展）
- 股票置换并购（仅现金/分期）
- 复杂财务会计科目（保持轻量）

---

## 21. 配置默认值（摘要）
- 回合：天；玩家确认进下一天
- 寿命：20年；开局35–55随机；初始现金50万
- 愿景：默认财富+事业；权重可自定义
- 胜利：TotalScore分位制（S/A/B/C/D/E）
- 事件：S级均值180天；可刷新（现金或IP），等级可±1档，保留世界状态
- 平台：电商快消；纯平台不做物流；抽佣5%；T+7；风控均衡；治理工具箱1+2+3+4+6；自营中后期解锁
- 贸易：全国统一市场；快消+大宗；每商品5–8家供应商；合同与现货并存
- 操作资源：AP=3/天可升至6；企业指令额度CmdCap随等级递增；重大决策名额=1/天（仅并购/上市/入新行业）
- 不回滚：退休前不可回滚（仅续玩最新状态）
